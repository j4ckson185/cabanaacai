<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Pagamento</title>
    <link rel="stylesheet" href="pagina_de_pagamento.css">
    <style>
        .button {
            padding: 5px 10px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-decoration: none;
            color: #fff;
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <!-- Estrutura HTML existente -->
    <div id="closed-message" class="hidden">Desculpe, estamos fechados no momento.</div>
    <form id="formulario-pagamento" class="hidden">
        <!-- Formulário de pagamento -->
        <input type="text" id="nome-sobrenome" placeholder="Nome e Sobrenome" required><br>
        <input type="text" id="cep" placeholder="CEP" required><br>
        <input type="text" id="endereco" placeholder="Endereço" required><br>
        <input type="text" id="numero" placeholder="Número" required><br>
        <input type="text" id="complemento" placeholder="Complemento"><br>
        <input type="tel" id="telefone" placeholder="Telefone" required><br>
        <input type="email" id="email" placeholder="Email" required><br>
        <label><input type="radio" name="payment-method" value="cartao" checked> Cartão de Crédito</label><br>
        <label><input type="radio" name="payment-method" value="dinheiro"> Dinheiro</label><br>
        <div id="troco-section" style="display: none;">
            <input type="text" id="troco" placeholder="Troco para">
        </div>
        <button type="submit">Finalizar Pedido</button>
        <a href="javascript:void(0)" id="whatsapp-link" class="button">Enviar Pedido pelo WhatsApp</a>
    </form>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB-pF2lRStLTN9Xw9aYQj962qdNFyUXI2E",
            authDomain: "cabana-8d55e.firebaseapp.com",
            projectId: "cabana-8d55e",
            storageBucket: "cabana-8d55e.appspot.com",
            messagingSenderId: "706144237954",
            appId: "1:706144237954:web:345c10370972486afc779b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Função para formatar moeda
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // Função para obter os detalhes completos do pedido
        function obterDetalhesPedido() {
            const carrinho = JSON.parse(sessionStorage.getItem('carrinho')) || [];
            let mensagem = "Pedido:\n\n";
            let subtotal = 0;

            carrinho.forEach(item => {
                mensagem += `Produto: ${item.nome}\n`;
                mensagem += `Preço: ${formatarMoeda(item.preco)}\n`;

                // Adicionar acompanhamentos
                if (item.acompanhamentos && item.acompanhamentos.length > 0) {
                    mensagem += "Acompanhamentos:\n";
                    item.acompanhamentos.forEach(acompanhamento => {
                        mensagem += `- ${acompanhamento}\n`;
                    });
                }

                // Adicionar itens extras
                if (item.itensExtras && item.itensExtras.length > 0) {
                    mensagem += "Itens Extras:\n";
                    item.itensExtras.forEach(extra => {
                        mensagem += `- ${extra}\n`;
                    });
                }

                mensagem += "\n";
                subtotal += parseFloat(item.preco);
            });

            const deliveryFee = 3.00;
            const total = subtotal + deliveryFee;

            mensagem += `Subtotal: ${formatarMoeda(subtotal)}\n`;
            mensagem += `Taxa de Entrega: ${formatarMoeda(deliveryFee)}\n`;
            mensagem += `Total: ${formatarMoeda(total)}\n\n`;

            return mensagem;
        }

        document.addEventListener('DOMContentLoaded', async function() {
            // Configuração dos elementos e eventos
            const whatsappLink = document.getElementById('whatsapp-link');

            whatsappLink.addEventListener('click', function() {
                const detalhesPedido = obterDetalhesPedido();
                const mensagemWhatsapp = encodeURIComponent(detalhesPedido);

                // Substitua o número de telefone abaixo pelo seu número de WhatsApp
                const numeroWhatsapp = "SEU-NUMERO-DE-TELEFONE";

                const whatsappURL = `https://wa.me/${numeroWhatsapp}?text=${mensagemWhatsapp}`;
                window.open(whatsappURL, '_blank');
            });

            // ... Restante do seu código aqui ...

        });
    </script>
</body>
</html>
